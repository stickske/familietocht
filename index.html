<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Familie fietstocht</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; background-color: black;}
    img { max-width: 100%; display: none; }
    h1 { color:white; }
  </style>
</head>
<body>
  <h1 id="info">Familie fietstocht</h1>
  <img id="photo" src="" alt="POI Photo">
  <audio id="ding" src="ding.mp3" preload="auto"></audio>

  <script>
    const info = document.getElementById("info");
    const photo = document.getElementById("photo");
    const sound = document.getElementById("ding");
    let inside = new Set();
    let pois = [];

    function distance(lat1, lon1, lat2, lon2) {
      const R = 6371000;
      const dLat = (lat2-lat1) * Math.PI/180;
      const dLon = (lon2-lon1) * Math.PI/180;
      const a = Math.sin(dLat/2)**2 +
                Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) *
                Math.sin(dLon/2)**2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    function checkPosition(pos) {
      const {latitude, longitude} = pos.coords;
      for (const poi of pois) {
        const d = distance(latitude, longitude, poi.lat, poi.lon);
        if (d < 10 && !inside.has(poi.name)) {
          inside.add(poi.name);
          info.innerHTML = poi.descr;
          photo.src = "img/" + poi.name + ".jpg";
          photo.style.display = "block";
          sound.play();
        }
        if (d >= 10 && inside.has(poi.name)) {
          inside.delete(poi.name);
        }
      }
    }


    //Screen always wake function
    let wakeLock = null;
    async function requestWakeLock() {
      try {
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', () => {
          console.log('Wake Lock released');
        });
      } catch (err) {
        console.error(`${err.name}, ${err.message}`);
      }
    }

    // Aanroepen bij laden
  requestWakeLock();



    navigator.geolocation.watchPosition(checkPosition, console.error, {enableHighAccuracy:true});

    fetch("pois.json")
      .then(res => res.json())
      .then(data => { pois = data; })
      .catch(err => console.error("Fout bij laden POI-data:", err));

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker geregistreerd"));
    }
  </script>
</body>
</html>